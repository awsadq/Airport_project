<!DOCTYPE html>
<html lang="ru" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Å—ã</title>
    <link rel="stylesheet" href="/project_css/flights.css">

</head>
<body>

<div class="page-container">

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#" th:href="@{/}">Airport Travel</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <ul class="nav navbar-nav navbar-center">
                <li><a href="/flights">–†–µ–π—Å—ã</a></li>
                <li><a href="/booking">–ë—Ä–æ–Ω—å –±–∏–ª–µ—Ç–æ–≤</a></li>
                <li><a href="/services">–£—Å–ª—É–≥–∏</a></li>
                <li><a href="/profile">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
            </ul>
            <!-- –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" -->
            <ul class="nav navbar-nav navbar-right">
                <li sec:authorize="isAuthenticated()">
                    <a href="#" onclick="confirmLogout()" class="btn-logout">–í—ã–π—Ç–∏</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

    <main>

<header>
    <h1>–¢–∞–±–ª–æ —Ä–µ–π—Å–æ–≤</h1>
    <form id="search-form" class="search-form">
        <div class="input-group">
            <label for="departure-airport">–ê—ç—Ä–æ–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
            <select id="departure-airport" name="departureAirport">
                <option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>

            </select>
        </div>
        <div class="input-group">
            <label for="arrival-airport">–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–±—ã—Ç–∏—è:</label>
            <select id="arrival-airport" name="arrivalAirport">
                <option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>

            </select>
        </div>
        <div class="input-group">
            <label for="status">–°—Ç–∞—Ç—É—Å:</label>
            <select id="status" name="status">
                <option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>
                <option value="–í—ã–ª–µ—Ç–µ–ª">–í—ã–ª–µ—Ç–µ–ª</option>
                <option value="–ó–∞–¥–µ—Ä–∂–∞–Ω">–ó–∞–¥–µ—Ä–∂–∞–Ω</option>
                <option value="–ü—Ä–∏–ª–µ—Ç–µ–ª">–ü—Ä–∏–ª–µ—Ç–µ–ª</option>
            </select>
        </div>
        <button type="submit" class="search-button">–ü–æ–∏—Å–∫</button>
    </form>

</header>

<section id="no-flights-message" style="display: none;">
    <p>–†–µ–π—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</p>
</section>


<section id="flights-list">
    <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–π—Å—ã</h2>
    <table>
        <thead>
        <tr>
            <th>‚Ññ –†–µ–π—Å–∞</th>
            <th>–ê—ç—Ä–æ–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</th>
            <th>–ê—ç—Ä–æ–ø–æ—Ä—Ç –ø—Ä–∏–±—ã—Ç–∏—è</th>
            <th>–í—Ä–µ–º—è –≤—ã–ª–µ—Ç–∞</th>
            <th>–í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è</th>
            <th>–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
            <th>–ü–µ—Ä–µ—Å–∞–¥–∫–∏</th>
            <th>–ì–æ—Ä–æ–¥–∞</th>
            <th>–†—É—á–Ω–∞—è –∫–ª–∞–¥—å</th>
            <th>–ë–∞–≥–∞–∂</th>

        </tr>
        </thead>
        <tbody id="flights-table-body">

        </tbody>
    </table>
</section>

<div class="background-image-overlay"></div>

    </main>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-left">
            <h2 class="footer-title">Airport Travel</h2>
            <p class="footer-description">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —Ü–∏—Ñ—Ä–æ–≤–æ–π –∞—ç—Ä–æ–ø–æ—Ä—Ç! –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –∫–æ–º—Ñ–æ—Ä—Ç<br>
                –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
            </p>
        </div>
        <div class="footer-right">
            <ul class="footer-menu">
                <li><a href="/flights">‚úàÔ∏è –†–µ–π—Å—ã</a></li>
                <li><a href="/booking">üìÑ –ë—Ä–æ–Ω—å –±–∏–ª–µ—Ç–æ–≤</a></li>
                <li><a href="/services">üõ†Ô∏è –£—Å–ª—É–≥–∏</a></li>
                <li><a href="/profile">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
            </ul>
        </div>
    </div>
    <hr class="footer-divider">
    <div class="footer-bottom">
        ¬© <?= date("Y") ?> Airport Travel. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
    </div>
</footer>


<script>

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ä–µ–π—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    async function loadAllFlights() {
        try {
            const response = await fetch('http://localhost:8086/api/flights');
            if (!response.ok) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤:', response.statusText);
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤');
            }
            const flights = await response.json();

            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–π—Å–∞—Ö –¥–æ—Å—Ç—É–ø–Ω—ã
            if (flights.length > 0) {
                const departureAirports = [...new Set(flights.map(f => f.departureAirport))];
                const arrivalAirports = [...new Set(flights.map(f => f.arrivalAirport))];
                const statuses = [...new Set(flights.map(f => f.status))];

                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Ñ–∏–ª—å—Ç—Ä—ã
                const departureInput = document.getElementById('departure-airport');
                const arrivalInput = document.getElementById('arrival-airport');
                const statusSelect = document.getElementById('status');

                // –£—Å—Ç–∞–Ω–æ–≤–∏–º "–Ω–∏—á–µ–≥–æ" –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–π –æ–ø—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                departureInput.innerHTML = `<option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>` +
                    departureAirports.map(airport => `<option value="${airport}">${airport}</option>`).join('');
                arrivalInput.innerHTML = `<option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>` +
                    arrivalAirports.map(airport => `<option value="${airport}">${airport}</option>`).join('');
                statusSelect.innerHTML = `<option value="–Ω–∏—á–µ–≥–æ">–ù–∏—á–µ–≥–æ</option>` +
                    statuses.map(status => `<option value="${status}">${status}</option>`).join('');
            }
            renderFlights(flights);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–π—Å–æ–≤:', error);
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function renderFlights(flights) {
        const tbody = document.getElementById('flights-table-body');
        const noFlightsMessage = document.getElementById('no-flights-message');

        tbody.innerHTML = '';
        noFlightsMessage.style.display = 'none';  // –°–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ä–µ–π—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

        if (flights.length === 0 && params.toString() !== "") {
            noFlightsMessage.style.display = 'block';

    } else {
            flights.forEach((flight) => {
                const row = document.createElement('tr');
                row.innerHTML = `
    <td>${flight.flightNumber || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.departureAirport || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.arrivalAirport || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.departureTime || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.arrivalTime || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>
        ${flight.airlineImage ? `<img src="${flight.airlineImage}" alt="airline logo" style="width:40px; vertical-align:middle; margin-right:5px;">` : ''}
        ${flight.airline || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
    </td>
    <td>${flight.status || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.totalPrice ? flight.totalPrice + ' —Å–æ–º' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.totalTime || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
    <td>${flight.stopCount || 0}</td>
    <td>${flight.transferCities?.join(', ') || '-'}</td>
    <td>${flight.baggageHand || '-'}</td>
    <td>${flight.baggageLuggage || '-'}</td>
`;

                tbody.appendChild(row);
            });
        }
    }

    // –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤
    const form = document.getElementById('search-form');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const params = new URLSearchParams();

        formData.forEach((value, key) => {
            if (value && value !== "–Ω–∏—á–µ–≥–æ") {
                params.append(key, value);
            }
        });

        try {
            const response = await fetch(`/api/flights/search?${params}`);
            if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ä–µ–π—Å–æ–≤: ${response.statusText}`);
            const flights = await response.json();
            renderFlights(flights);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ä–µ–π—Å–æ–≤:', error.message);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ä–µ–π—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ä–µ–π—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = loadAllFlights;

</script>

</div>
</body>
</html>
